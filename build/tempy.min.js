(function(b,a){if(typeof exports==="object"){module.exports=a()}else{if(typeof define==="function"&&define.amd){define(a)}else{b.Tempy=a()}}})(this,function(){function a(c){this.string=c;this.tail=c;this.pos=0}a.prototype={eos:function(){return this.tail===""},scan:function(e){var d=this.tail.match(e);if(!d||d.index!==0){return false}var c=d[0];this.tail=this.tail.substring(c.length);this.pos+=c.length;return d[0]},scanUntil:function(f){var c,e,d=this.tail.match(f);if(d===null){c=this.tail;this.tail="";this.pos+=c.length;return c}e=d.index;c=this.tail.substring(0,e);this.tail=this.tail.substring(e);this.pos+=e;return c}};var b={};b.read=function(e){var f={},h=/[\n\r;]|(\}\})|(--)/,c=/[\n\r;]/,g=function(l){return l.replace(/(^\s*)|(\s*$)/g,"")},d=function(n){var m,l=f;n=n.split(".");while(m=n.shift()){if(typeof l[m]==="undefined"){throw new Error("no value")}l=l[m]}return l},i=function(l){l=g(l);if(/^true$/i.test(l)){return true}if(/^false$/i.test(l)){return false}if(/^null$/i.test(l)){return null}if(/^(0|[1-9][0-9]*)$/.test(l)){return parseInt(l)}if(/^"((?:[^"]|\\")*)"$/.test(l)){return l.slice(1,-1).replace(/\\"/,'"').replace(/\\n/,"\n")}if(/^'([^']*)'$/.test(l)){return l.slice(1,-1)}if(/^([a-zA-Z_][a-zA-Z0-9_]*)(\.(([a-zA-Z_][a-zA-Z0-9_]*)|(0|[1-9][0-9]*)))*$/.test(l)){try{return d(l)}catch(m){return}}throw new Error("알 수 없는 타입")},k=function(n){var l=[];for(var m in n){if(n.hasOwnProperty(m)){l.push({k:m,v:n[m]})}}return l},j=function(l){return l[l.length-1]};return{assign:function(l,m){f[l]=m},render:function(v){for(idx in v){this.assign(idx,v[idx])}var q=new a("}}"+e+"{{"),x="",s,t={t:0,isp:true},u=[];u.push(t);while(!q.eos()){if(q.scan(/^\s*\}\}/)){s=q.scanUntil(/\{\{/);if(t.isp){x+=s}q.scan(/\{\{\s*/);continue}if(q.scan(/^\s*--/)){s=q.scanUntil(h);q.scan(c);continue}if(q.scan(/^\s*\=\s*/)){s=q.scanUntil(h);if(t.isp){s=i(s);if(typeof s!=="undefined"&&s!==null){x+=s.toString()}}q.scan(c);continue}if(q.scan(/^\s*\?/)){s=q.scanUntil(h);s=i(s);if(s){t={t:1,isp:t.isp,status:1}}else{t={t:1,isp:false,status:0}}u.push(t);q.scan(c);continue}if(q.scan(/^\s*\@/)){s=q.scanUntil(h);var o,r=s.split("->"),m=k(i(r[0])||""),l=null,n=g(r[1]),w=m.length;if((o=n.indexOf(":"))!==-1){l=g(n.substring(0,o));n=g(n.substring(o+1));if(l==""){l=null}if(n==""){n=null}}if(w===0||t.isp===false){t={t:2,isp:false,status:1}}else{if(l!==null){f[l]=m[0].k}if(n!==null){f[n]=m[0].v}t={t:2,isp:t.isp,status:0,tail:q.tail,pos:q.pos,iter:{key:l,name:n,value:m,len:w,i:0}}}u.push(t);q.scan(c);continue}q.scan(/^\s*\;/);switch(t.t){case 1:if(q.scan(/^\s*\:\?/)){s=q.scanUntil(h);if(t.status===1){t.isp=false}else{s=i(s);if(s){t.isp=true;t.status=1}}q.scan(c)}if(q.scan(/^\s*\:/)){if(t.status===1){t.isp=false}else{t.isp=true}q.scan(c)}if(q.scan(/^\s*\//)){u.pop();t=j(u);q.scan(c)}continue;case 2:if(q.scan(/^\s*\//)){if(t.status===0){var r=t.iter;r.i++;if(r.i<r.len){if(r.key!==null){f[r.key]=r.value[r.i].k}if(r.name!==null){f[r.name]=r.value[r.i].v}q.tail=t.tail;q.pos=t.pos}else{t.status=1}}if(t.status===1){u.pop();t=j(u);q.scan(c)}}continue}x+="<!--Parsing Error-->";break}return x}}};return b});