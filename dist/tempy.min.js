/*! tempy.js 2014-09-15 */
!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Tempy=b()}(this,function(){var a=function(a){this.string=a,this.tail=a,this.pos=0};a.prototype={eos:function(){return""===this.tail},scan:function(a){var b=this.tail.match(a);if(!b||0!==b.index)return!1;var c=b[0];return this.tail=this.tail.substring(c.length),this.pos+=c.length,b[0]},scanUntil:function(a){var b,c,d=this.tail.match(a);return null===d?(b=this.tail,this.tail="",this.pos+=b.length,b):(c=d.index,b=this.tail.substring(0,c),this.tail=this.tail.substring(c),this.pos+=c,b)}};var b=function(){},c=function(a){return a.replace(/(^\s*)|(\s*$)/g,"")};return b.read=function(b){var d={},e=/[\n\r;]|(\}\})|(--)/,f=/[\n\r;]/,g=function(a,b){d[a]=b},h=function(a){var b,c=d;for(a=a.split(".");b=a.shift();){if("undefined"==typeof c[b])throw new Error("no value");c=c[b]}return c},i=function(a){var b=j(a);return"object"==typeof b?JSON.stringify(b):b},j=function(a){if(a=c(a),/^true$/i.test(a))return!0;if(/^false$/i.test(a))return!1;if(/^null$/i.test(a))return null;if(/^(0|[1-9][0-9]*)$/.test(a))return parseInt(a);if(/^"((?:[^"]|\\")*)"$/.test(a))return a.slice(1,-1).replace(/\\"/,'"').replace(/\\n/,"\n");if(/^'([^']*)'$/.test(a))return a.slice(1,-1);if(/^([a-zA-Z_][a-zA-Z0-9_]*)(\.(([a-zA-Z_][a-zA-Z0-9_]*)|(0|[1-9][0-9]*)))*$/.test(a))try{return h(a)}catch(b){return}throw new Error("알 수 없는 타입")},k=function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({k:c,v:a[c]});return b},l=function(a){return a[a.length-1]};return{assign:g,render:function(g){for(idx in g)this.assign(idx,g[idx]);var h,m=new a("}}"+b+"{{"),n="",o={t:0,isp:!0},p=[];for(p.push(o);!m.eos();)if(m.scan(/^\s*\}\}/))h=m.scanUntil(/\{\{/),o.isp&&(n+=h),m.scan(/\{\{\s*/);else if(m.scan(/^\s*\=\s*/))h=m.scanUntil(e),o.isp&&(h=i(h),"undefined"!=typeof h&&null!==h&&(n+=h.toString())),m.scan(f);else if(m.scan(/^\s*--/))h=m.scanUntil(e),m.scan(f);else if(m.scan(/^\s*\?/))h=m.scanUntil(e),h=i(h),o=h?{t:1,isp:o.isp,status:1}:{t:1,isp:!1,status:0},p.push(o),m.scan(f);else{if(!m.scan(/^\s*\@/)){switch(m.scan(/^\s*\;/),o.t){case 1:m.scan(/^\s*\:\?/)&&(h=m.scanUntil(e),1===o.status?o.isp=!1:(h=i(h),h&&(o.isp=!0,o.status=1)),m.scan(f)),m.scan(/^\s*\:/)&&(o.isp=1===o.status?!1:!0,m.scan(f)),m.scan(/^\s*\//)&&(p.pop(),o=l(p),m.scan(f));continue;case 2:if(m.scan(/^\s*\//)){if(0===o.status){var q=o.iter;q.i++,q.i<q.len?(null!==q.key&&(d[q.key]=q.value[q.i].k),null!==q.name&&(d[q.name]=q.value[q.i].v),m.tail=o.tail,m.pos=o.pos):o.status=1}1===o.status&&(p.pop(),o=l(p),m.scan(f))}continue}n+="<!--Parsing Error-->";break}h=m.scanUntil(e);var r,q=h.split(":"),s=k(j(q[0])||""),t=null,u=c(q[1]),v=s.length;-1!==(r=u.indexOf(","))&&(t=c(u.substring(0,r)),u=c(u.substring(r+1)),""==t&&(t=null),""==u&&(u=null)),0===v||o.isp===!1?o={t:2,isp:!1,status:1}:(null!==t&&(d[t]=s[0].k),null!==u&&(d[u]=s[0].v),o={t:2,isp:o.isp,status:0,tail:m.tail,pos:m.pos,iter:{key:t,name:u,value:s,len:v,i:0}}),p.push(o),m.scan(f)}return n}}},b});